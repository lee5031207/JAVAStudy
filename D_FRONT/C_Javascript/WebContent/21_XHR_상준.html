<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style type="text/css">
   .wrap>div{
      display:flex;
      justify-content:space-between;
      height:10vw;
      width:80vw;
      text-align:center;
      font-size:1vw;
   }
   .wrap>div>div{
      width:20%;
      height:90%;
      border:1px solid black;
      background-repeat: no-repeat;
      background-position: center;
      background-size: contain;
   }
   .wrap>div:first-child{
      height:20%;
   }
   img{
      width:30%;
      height:90%;
   }
</style>
</head>
<body>
<script type="text/javascript">
function $(selector,text) {
	if(text) {
		document.querySelector(selector).innerHTML += `${text}<br>`;
	}
	return document.querySelector(selector);
}
</script>
<input type="text" id="keyword">
<button id="btn_search">검색</button>
<hr>
<div class="wrap">
	<div class="wrap_book">
		<div class="title">제목</div>
		<div class="price">가격</div>
		<div class="publisher">출판사</div>
		<div class="thum">이미지</div>
	</div>
</div>
<script type="text/javascript">
(()=>{
	let page;
	//중간에 입력값이 바뀌어도 기존 키워드를 검색하기 위해 키워드를 변수(전역)으로 설정하였습니다. 
	let keyword;
	$('#btn_search').addEventListener('click',()=>{
		page = 1;
		//이부분이 키워드 따오는 부분입니다. 
		keyword = $('#keyword').value;
		$('.wrap').innerHTML = $('.wrap_book').outerHTML;
		retrieveBooks();
	});
	document.addEventListener('wheel',()=>{
		if(scrollY > $('body').clientHeight-screen.availHeight) {
			retrieveBooks();
		}
	}); 
	function retrieveBooks() {
		let xhr = new XMLHttpRequest();
		//시작줄 작성
		//이부분이 제가 작성한 키워드 넣는 곳입니다. 
		xhr.open('get','https://dapi.kakao.com/v3/search/book?query='+keyword+'&page='+page);
		//헤더 작성
		//get방식은 파라미터를 전송하기 위해 쿼리스트링을 사용한다.
		//쿼리스트링은 url뒤에 ?를 붙여주고 파리미터명=값 형태로 작성해준다.
		//만약 전송해야 하는 파라미터가 여러개라면 &로 구분해준다.
		//ex) url?name=value&name=value
		xhr.setRequestHeader('Authorization','KakaoAK 8f0a8bf7d90077ec52cc56e4a88c0fcd');
		//전송, 바디가 있을 경우 바이에 넣어줄 매개변수로 넘겨준다.
		xhr.send();
		//비동기통신이 성공적으로 끝나면 콜백함수 호출
		xhr.addEventListener('load', ()=>{
			//응답 바디 출력
			//JSON.parse() : json -> object
			//JSON.stringify() : object -> json
			let obj = JSON.parse(xhr.response);
			console.dir(obj);
			if(obj.meta.is_end) {
				alert('검색결과가 더 이상 없습니다');
				return;
			}
			page++;
			let copy = $('.wrap_book').outerHTML;
			

			obj.documents.forEach((e)=>{
				$('.wrap').innerHTML += copy;
				let bookInfo = $('.wrap').lastElementChild;
				bookInfo.children[0].innerHTML = e.title;
				bookInfo.children[1].innerHTML = e.price;
				bookInfo.children[2].innerHTML = e.publisher;
				bookInfo.children[3].innerHTML = '';
				bookInfo.children[3].style.backgroundImage = `url(${e.thumbnail})`;
			});
		});
	}
})();
</script>
</body>
</html>